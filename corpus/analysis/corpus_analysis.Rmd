---
title: "Analysis of wh-questions"
author: "mcmoyer"
date: "October 22, 2020"
output: html_document
---
  
## Step 1: select stimuli for experiment
  
Set your path here and load some packages that are necessary for visualization 
(ggplot), tidy data handling (tidyr and dplyr), and mixed effects modeling (lme4:
                                                                                                                                                               
```{r}  
library(ggplot2)
library(tidyr)
library(dplyr)
library(lme4)
# theme_set(theme_bw())

this.dir <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(this.dir)
source("../../analysis/helpers.R")
```

Read the database into R and explore it.
```{r}
d = read.table("../results/swbd.tab",sep="\t",header=T,quote="")

# Load in the .csv with the contexts removed
# d = read.csv("swbd_nocntxt.csv",header=T)
View(d)
# old
nrow(d) # 10667.....10278....10192 (added MACRO (@WH > /^WH/)...10199 (@WH >> /^WH)
head(d)
str(d)
summary(d)

str(d)
table(d$QuestionType)
# Make sure there are none without a tag
nonya <- subset(d, d$QuestionType=="")
nrow(nonya)
# 
#  adjunct       cleft  embadjunct    embedded exclamation    fragment    relative        
#         775         586        2401        2432          34         126        1378        root     subject 
#         1719         748 


nrow(subset(d,d$QuestionType=="cleft")) #650
nrow(subset(d,d$QuestionType=="embedded")) #2357

# randomly sample an embedded clause
d_emb = subset(d, d$QuestionType=="embedded")
d_crit = d_emb %>%
  filter(Wh %in% c("who","where","how"))
nrow(d_emb) # 3018 --> 2421 --> 2357
nrow(d_crit) #1087 --> 954 --> 912
set.seed(123)
set.seed(321)
see <- sample_n(d_crit,30)
# names(see)
# look at just the columns of interest
View(see[,c("Item_ID","Sentence","MatrixPred1","InvertedAuxVerb","MatVerbPart","Question","SentenceParse")])

d[d["Item_ID"] == "331:188"] # shouldn't be embedded
d[d["Item_ID"] == "107183:17"] # shouldn't be embedded
d[d["Item_ID"] == "155340:11"] # shouldn't be embedded
d[d["Item_ID"] == "37590:29"]
d[d["Item_ID"] == "72099:29"]
# 

# and kind of a couple of people, they just took it from me without me knowing really and kind of passed it off, so i didn't know who *t*-1 had it.



# for verb issues : 19249:155 (should not have MatPred1 filled)

```
for sentence.ptn: @WH >> (*=print !> *)
for question.ptn: @WH >> /^S/=print
for MatrixClause: @WH >> (/^WH/ > (/s/ ))

163362:21
@WH >> (/^WH/ > (/^SBAR/ [$ /^VB|^JJ|^RB/=vp | > (/^PP/=pp $ /^JJ|^VB|^RB/)])) >> (/S/=print < (/VP/ [< =vp | < =pp]))

new MatrixPredVerb
@WH >> (/^WH/ > (/^SBAR/ $ (/^VB/=vp ))) >> (/S/ < (/VP/ < =vp=print))

MatrixPredOther
@WH >> (/^WH/ > (/^SBAR/ $ (/^JJ|^RB/=pred ))) >> (/S/ < (/VP/ < =pred=print))

MatrixPredParticle
@WH >> (/^WH/ > (/^SBAR/ $ (/^PP|^IN/ < /^VB|^JJ|^RB/=pred ))) >> (/S/ < (/VP/ < =pred=print))

(TOP (S (NP-SBJ (PRP$ Their) (NN military)) 
        (VP (VBZ is) 
            (ADJP-PRD (JJ different) (PP (IN from) (NP (PRP ours))) (, ,)) 
            (PP (IN to) 
                (SBAR-NOM (WHADVP-6 (WRB where)) (S (NP-SBJ (EX there)) (VP (VBP are) (NP-PRD (NP (JJ extremist) (EDITED (RM (-DFL- \[)) (NNS gen-) (, ,) (IP (-DFL- \+))) (NNS generals)) (RS (-DFL- \])) (SBAR (WHNP-1 (WDT that)) (S (NP-SBJ (-NONE- *T*-1)) (ADVP (RB actually)) (VP (VBP control) (NP (NP (NNS tens) (CC and) (NNS thousands)) (PP (IN of) (NP (NNS troops))) (. .) (-DFL- E_S) (SBAR (WHNP-3 (IN That)) (-DFL- N_S) (S (ADVP (JJ irregardless) (PP (IN of) (SBAR-NOM (WHNP-2 (WP what)) (S (NP-SBJ (NNP Soviet) (NN policy)) (VP (VBZ is) (NP-PRD (-NONE- *T*-2))))))) (, ,) (NP-SBJ-4 (NP (-NONE- *T*-3)) (NP (PRP they))) (VP (VBP 're) (VP (VBG going) (S (NP-SBJ (-NONE- *-4)) (VP (TO to) (VP (VB do) (SBAR-NOM (WHNP-5 (WP what)) (S (NP-SBJ (DT the) (NN general)) (VP (VBZ tells) (NP (PRP them)) (NP (-NONE- *T*-5))))))))))))))))) (ADVP (-NONE- *T*-6))))))) (. .) (-DFL- E_S)))


(TOP (S (INTJ (UH Well)) 
        (, ,) (EDITED (RM (-DFL- [)) 
        (S (NP-SBJ (PRP I)) (VP-UNF (VBP do))) 
        (, ,) (IP (-DFL- +))) 
        (NP-SBJ (PRP I)) 
        (VP (VBP do) (RS (-DFL- ])) 
            (VP (VB realize) 
                (SBAR (IN that) 
                      (S (NP-SBJ (DT the) (NNP Bush) (NNP Administration)) 
                          (VP (VBZ is) 
                              (RB n't) 
                              (ADJP-PRD (RB too) (JJ happy) 
                              (EDITED (RM (-DFL- [)) 
                                      (PP (IN with) 
                                          (SBAR (WHADVP-2 (WRB how)) (S (NP-SBJ (PRP they)) (VP (VBP 're) (VP (VBG handling) (NP (PRP$ their) (JJ internal) (, ,) (INTJ (UH uh)) (, ,) (NN strife)) (ADVP-MNR (-NONE- *T*-2)))))))) (PRN (, ,) (S (NP-SBJ (PRP you)) (VP (VBP know))) (, ,)) (ADVP (ADVP (RB as) (RB far)) (SBAR (IN as) (S (NP-SBJ-1 (NN diplomacy)) (VP (VBZ is) (VP (JJ concerned) (NP (-NONE- *-1)))))))))))) (. .) (-DFL- E_S)))

Take a random sample of 200.
```{r}
set.seed(123)
s <- sample_n(d, 200)
View(s)
View(s[,c("Item_ID","QuestionType","Sentence","Question","SentenceParse")])

nrow(s)
# write to CSV

write.csv(s, "whq_sample_200.csv",row.names = TRUE)

s_emb = subset(s, s$QuestionType=="embedded")
View(s_emb)

```
https://github.com/thegricean/corpus_implicatures/tree/master/or/experiments/4_implicature_exp/experiments/02_main/experiment_00/js

https://github.com/thegricean/corpus_implicatures/blob/master/some/experiments/main_experiments/speaker_knowledge/experiment_01/public/js/stimuli.js
https://raw.githubusercontent.com/leylakursat/some_without_context/master/experiment/corpora/corpus1.txt

https://thegricean.github.io/corpus_implicatures/or/experiments/4_implicature_exp/experiments/02_main/experiment_00/index.html


Reproduce the same set
```{r}
# the original DF i sent jd
sa <- read.csv("whq_sample_200_A.csv", header=TRUE)


sa = sa[order(sa$Item_ID),]

# this will remove any columns that aren't shared 
ddnew = semi_join(sa, d, by=c("Item_ID"))
# drop that first column
ddnew = ddnew[-c(1)]
write.csv(ddnew, "whq_sample_200_neworig.csv",row.names = TRUE)

# try to check if they're the same IDs

ddnew_names = ddnew$Item_ID
sa_names = sa$Item_ID
length(sa_names)

all.equal(ddnew_names,sa_names)

View(ddnew)

# this doesn't remove any columns that aren't in sa
snew = d %>%
  filter(Item_ID %in% sa$Item_ID)

View(snew)
write.csv(snew, "whq_sample_200_neworig.csv",row.names = TRUE)
# save it to a csv file and provide an annotation guide for what 
# the different types of features should be
# overleaf. 
# 
```

# some embedded cases aren't printing a matrix verb
```{r}
emb <- subset(d, d$QuestionType=="embedded")
nrow(emb)


enmv = emb %>%
  filter(MatrixPred1 %in% c(""))
nrow(enmv) # 3333.....0! fixed
View(enmv)

```
Take a look at cases where there is no questionType assigned.
```{r}
no_qt = subset(d, d$QuestionType=="")
nrow(no_qt) # 1016....819....20....18...0!
View(no_qt)
```
Look at the modal and non-modal cases
```{r}

mod = subset(d, d$ModalPresent=="yes")
nrow(mod) # 895

nmod = subset(d, d$ModalPresent=="no")
nrow(nmod) # 9235

table(d$ModalPresent)

nf2 <- subset(d, d$Finite=="no") # YES THESE ARE ALL GOOD
nrow(nf2) #190....186?
View(nf2)
# sanity check
nf <- subset(d, d$Finite!="yes") 
nrow(nf) #186
View(nf)

# Do these return all the same ?
all.equal(nf,nf2) # TRUE
````
cases that are tagged neither as modal or non-modal



````{r}
notmod = subset(d, d$ModalPresent!="no" & d$ModalPresent!="yes")
nrow(notmod)
View(notmod)
str(d)
notmodcomp = d %>%
  filter(!ModalPresent %in% c("yes","no")) %>%
  filter(WhPhraseType %in% c("complex"))

notmodcomp2 = subset(notmod, notmod$WhPhaseType=="complex")
nrow(notmodcomp2) # so there are non-complex wh that are failing
notmodnotcomp = subset(notmod, notmod$WhPhaseType!="complex")
nrow(notmodnotcomp)
View(notmodnotcomp)

```


```{r}
dd = grepl("can|could|may|might|must|shall|should", d$Sentence)
View(dd)

mods <- ""
for (r in notmod){
    if (grepl("can|could|may|might|must|shall|should", notmod$Sentence))
    mods + r
  }
```

Graphssss

```{r}
ftable(d$QuestionType,d$ModalPresent)

agr = d %>%
  group_by(QuestionType,ModalPresent,Finite) %>%
  mutate(count = count(Sentence), prop_modal= ) %>%
  
  ggplot(d, aes(x=as.factor(QuestionType),y=as.factor(Finite), fill = as.factor(ModalPresent))) +
  geom_bar()
  
View(agr)

```

Looking at embedded questions
```{r}


```
